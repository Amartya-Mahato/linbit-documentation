[[ch-opennebula]]
== DRBD Volumes in OpenNebula

indexterm:[OpenNebula]This chapter describes DRBD in OpenNebula via the usage
of the[DRBD Manage storage driver addon](https://github.com/OpenNebula/addon-drbdmanage).

[[s-opennebula-overview]]
=== OpenNebula Overview

[OpenNebula](http://opennebula.org/) is a flexible and open source cloud
management platform which allows its functionality to be extended via the use
of addons.

The DRBD Manage addon allows the deployment of virtual machines with highly
available images backed by DRBD and attached across the network with DRBD
Transport.

[[s-opennebula-install]]
=== OpenNeubla Installation

Installation of the DRBD Manage storage addon for OpenNebula requires a working
OpenNebula cluster as well as a working DRBD cluster managed by DRBD Manage.

OpenNebula provides documentation of its
[Design and Installation](http://docs.opennebula.org/4.14/design_and_installation/index.html)
which should be consulted when considering the creation of a new OpenNebula
cluster.

//TODO: Link do the guide not hyperlink????
DRBD cluster with DRBD Manage can be installed and configured by following the
instructions in this guide.

The OpenNebula and DRBD clusters can be somewhat independent of one another with
the following exceptions:

  * OpenNebula's Front-End and Host nodes must be included in both clusters.
  * The Front-End node must have a local copy of the `drbdmanage` control
  volume.

Host nodes do not need a local copy of the `drbdmanage` control volume and
virtual machine images are attached to them across the network. These features
simplify the process of adding DRBD to an existing OpenNeubla cluster. If this
is desired, they may be added to the DRBD Manage cluster using the
`--no-storage` and `--satellite` options.

Instructions for installing and configuring the DRBD Manage addon for OpenNebula
can be found in the README.md file of the addon. Or by visiting the
[GitHub page](https://github.com/OpenNebula/addon-drbdmanage)
for the driver.

[[s-opennebula-free-space]]
=== Free Space Reporting

Free space is calculated differently depending on whether resources are deployed
according to `DRBD_REDUNDANCY` or `DRBD_DEPLOYMENT_NODES`.

For datastores using `DRBD_DEPLOYMENT_NODES`, free space is reported based on
the most restrictive nodes. For example, the capacity of the node with the
smallest amount of total storage space is used to determine the total size of
the datastore and the node with the least free space is used to determine the
remaining space in the datastore.

For a datastore which uses `DRBD_REDUNDANCY`, size and remaining space are
determined based on the aggregate storage of the cluster divided by the level
of redundancy. It is possible that the free space reported will be larger than
the space remaining on any single node. For example, a freshly installed
cluster with two storage nodes that both have a capacity of 100Gb and a
redundancy level of 1 will report 200Gb of free space, even though no node
can store a 200Gb volume. The driver is able to determine this at the time a
new image is created and will alert the user.

[[ch-proxmox]]
== DRBD Volumes in Proxmox VE

indexterm:[Proxmox]This chapter describes DRBD in Proxmox VE via the usage
of the http://git.linbit.com/drbdmanage-proxmox.git[DRBD Manage Proxmox Plugin].

[[s-proxmox-overview]]
=== Proxmox VE Overview

http://www.proxmox.com/en/[Proxmox VE] is an easy to use, complete server
virtualization environment with KVM, Linux Containers and HA.

'drbdmange-proxmox' is a Perl plugin for Proxmox that in combination with DRBD Manage allows that VM
disks (LVM volumes on DRBD) are replicated on several Proxmox VE nodes. This provides the ability to live
migrate running machines without downtime in a few seconds without the need of a SAN as the data is already
replicated to multiple nodes.

[[s-proxmox-install]]
=== Proxmox Plugin Installation

LINBIT provides a dedicated, public repository for Proxmox VE users. This repository not only contains the
Proxmox plugin, but the whole DRBD SDS stack including a patched version of DRBD Manage, DRBD SDS kernel
module and user space utiliteis, and of course the Proxmox Perl plugin itself. This repository can be enabled
as follows:

----------------------------
# wget -O- https://packages.linbit.com/package-signing-pubkey.asc | apt-key add -
# echo "deb http://packages.linbit.com/proxmox/ proxmox-4 drbd-9.0" > \
	/etc/apt/sources.list.d/linbit.list
# apt-get update && apt-get install drbdmanage-proxmox
----------------------------

If you are an existing user of Proxmox's version of DRBD Manage, you can simply enable the repository and
install +drbdmanage-proxmox+, you don't have to change your existing configuration.

[[s-proxmox-configuration]]
=== Proxmox Plugin Configuration
The first step is a static IP address for DRBD traffic. As Proxmox is Debian GNU/Linux based, this is
configured via +/etc/network/interfaces+.

The second sep is to configure DRBD Manage as described in <<s-dm-init-cluster>>.

The last step is to provide a configuration for Proxmox itself. This is done by adding an entry to
+/etc/pve/storage.cfg+ with the following content, assuming a three node cluster in our example:

----------------------------
drbd: drbdstorage
   content images,rootdir
   redundancy 3
----------------------------

After that you can create VMs via Proxmox's web GUI by selecting "drbdstorage" as your storage.

.NOTE: DRBD supports only raw disk format at the moment.

At this point you can try to live migrate the VM - as all data is available on both nodes it will take just a
few seconds. The overall process might take a bit longer if the VM is under load and if there is a lot of RAM
involved. But in any case, the downtime is minimal and you will see no interruption at all.
